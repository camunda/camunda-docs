# Properties reference pages

This documentation contains properties reference pages.

They are generated from `spring-configuration-metadata.json` [files](https://docs.spring.io/spring-boot/specification/configuration-metadata/format.html) that are processed and applied to a template.

The base directory for all properties reference pages is `/config-reference`.

Within this directory, two main tasks occur:

- Documentation is generated from the metadata.
- The metadata itself is updated from the released artifact.

## Docs generation

### What this does

The generation process runs in several steps:

1. Retrieves the component and version for which a properties reference should be generated by reading the command used.
2. Finds the mapped strategy.
3. Retrieves the metadata file, output directory, output file name, and component name from the strategy.
4. Executes the generation workflow:
   - Cleans the config reference (deletes the old file).
   - Runs predefined and strategy-defined pre-generation steps.
   - Generates the properties reference and writes it to the target file.
   - Runs predefined and strategy-defined post-generation steps.
   - Applies final formatting.

### How to use it

The command to generate the docs is registered in `package.json` and can be run as an `npm run` script:

```shell
npm run config-reference:generate:${COMPONENT_NAME}
```

For multiple supported versions:

```shell
npm run config-reference:generate:${COMPONENT_NAME}:${VERSION}
```

## Metadata update

The metadata is packaged within a Java archive. The easiest way to get the most recent version is by downloading the latest artifact.

### What this does

The download process follows the same steps as generation but updates the metadata file rather than generating documentation:

1. Retrieves the component and version for which a properties reference should be generated.
2. Finds the mapped strategy.
3. Retrieves the metadata file, output directory, output file name, and component name from the strategy.
4. Runs a strategy-defined function to update the metadata file.

### How to use it

The command to download the metadata file is registered in `package.json` and can be run as an `npm run` script:

```shell
npm run config-reference:download:${COMPONENT_NAME}
```

For multiple supported versions:

```shell
npm run config-reference:download:${COMPONENT_NAME}:${VERSION}
```

## Extending the setup

To generate your own properties reference, define and register a strategy:

1. Create a new directory under `/config-reference` with the name of your component.  
   All reference generation code for your component lives here.

2. Define a `generation-strategy.js` file with this structure:

```js
const baseDir = "./config-reference/..."; // Path to your config reference base directory

function getOutputDir(version) {
  return version === undefined ? "" : ""; // Return paths for next vs. versioned output directories
}

const getMetadata = (version) => {
  return version === undefined ? myMetadata : myVersionedMetadata; // Return correct metadata JSON
};

const getFilename = (version) => {
  return "properties-reference.md"; // File name for your Markdown output
};

const preGenerateDocs = async (generationConfig) => {}; // Customizations before generation
const postGenerateDocs = async (generationConfig) => {}; // Customizations after generation
const downloadReference = async (version) => {}; // Ensure metadata for `getMetadata(version)` is up-to-date

const componentName = ""; // Human-readable name of your component
const useHelm = false; // Set true if docs should include Helm values; each property needs a "helm" field

module.exports = {
  getOutputDir,
  getMetadata,
  getFilename,
  preGenerateDocs,
  postGenerateDocs,
  downloadReference,
  componentName,
  baseDir,
};
```

3. Register your strategy in `/config-reference/generate-config-reference.js` under `configRefStrategies` using the name youâ€™ll call in the `npm run` script.

4. Add an `npm run` script to `/package.json` for generating and downloading docs for your component.

5. Run `npm run` to execute the generation and review:
   - Is all text correctly formatted?
   - Are property types replaced correctly?  
     If not, customize `preGenerateDocs()` in your strategy or extend the global `typeReplacements` map in `/config-reference/generate-config-reference.js`.
