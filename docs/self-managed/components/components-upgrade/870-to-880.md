---
id: 870-to-880
sidebar_label: Update 8.7 to 8.8
title: Components update 8.7 to 8.8
description: "Review which adjustments must be made to update from Camunda 8.7.x to Camunda 8.8.0."
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

The following sections explain which adjustments must be made to migrate from Camunda 8.7.x to 8.8.x.

## Camunda Orchestration Cluster Identity Migration

Camunda 8.8 introduces Orchestration Cluster Identity as a separate component within the Orchestration Cluster, you can learn more about it [here](../../../reference/announcements-release-notes/880/whats-new-in-88.md#identity-and-management-identity).

To ease the effort for migrating data from [Management Identity](../management-identity/overview.md) to the new [Orchestration Cluster Identity](../orchestration-cluster/identity/overview.md), a Identity Migration Application is provided.

:::note
The Identity migration is automatically setup and executed in the official Camunda Helmchart, when [enabled](../../deployment/helm/upgrade/helm-870-880.md#3-identity-migration).
:::

### Running the Identity Migration Application

The application can be run [locally for manual setups](../../deployment/manual/install.md) or from a docker container.

#### Running the migration natively

Using the native distribution of Camunda 8, you can run the Identity Migration Application as follows:

<Tabs groupId="os" defaultValue="maclinux" values={
[
{ label: 'Mac OS + Linux', value: 'maclinux', },
{ label: 'Windows', value: 'windows', },
] }>
<TabItem value="maclinux">

```bash
./bin/identity-migration
```

</TabItem>
<TabItem value="windows">
```bash
./bin/identity-migration.bat
````

</TabItem>
</Tabs>

#### Running the migration using the `camunda/camunda:8.8.0` docker image.

You can run the Identity Migration Application by overriding the default entrypoint of the official Camunda 8 Docker image to `/usr/local/camunda/bin/identity-migration`, e.g. as such:

```
docker run --entrypoint /usr/local/camunda/bin/identity-migration camunda/camunda:8.8.0
```

### Configuration of the Identity Migration Application

The Identity Migration Application supports two scenarios to migrate from, each of those requires different configuration properties and values to be set.

Configuration can generally be set by directly modifying the application.yaml The default location of the config within the Camunda 8 distribution is `./config/application.yaml` and `/usr/local/camunda/config/application.yaml` in the docker image respectively.

Alternatively all properties can also be set via Environment variables.

#### Common Configuration for the Identity Migration Application

The Identity Migration Application needs to join the Orchestraction Cluster in order to create Identity Access Management records, the values can be taken from equivalent configuration of the Orchestration Cluster nodes.

Furthermore the Identity Migration Application requires full access to the [Management Identity](../management-identity/overview.md) API and thus valid client credentials for a client with `read` permissions to access it.

<Tabs>
  <TabItem value="env" label="Environment variables" default>

| Environment variable                                             | Description                                                                                                                                                                                     | Required value                                                                                                                                                                                                                                               |
| ---------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `CAMUNDA_MIGRATION_IDENTITY_MODE`                                | Mode of the migration app.                                                                                                                                                                      | In case of the [Camunda Identity 8.7 default (Keycloak)](../management-identity/overview.md) setup: `KEYCLOAK`. <br></br> In case of the [Camunda Identity 8.7 with OIDC](../management-identity/configuration/connect-to-an-oidc-provider.md) setup: `OIDC` |
| `CAMUNDA_MIGRATION_IDENTITY_RESOURCEAUTHORIZATIONSENABLED`       | Signals whether [Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md) were used in the 8.7, defaults to `false`. | Must be `true` in case [Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md) were used.                                                                                       |
| `CAMUNDA_MIGRATION_IDENTITY_CLUSTER_CLUSTERNAME`                 | Name of the Orchestration cluster.                                                                                                                                                              | Same value as used on the cluster for [`ZEEBE_BROKER_CLUSTER_CLUSTERNAME`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                         |
| `CAMUNDA_MIGRATION_IDENTITY_CLUSTER_CLUSTERSIZE`                 | Size of the Orchestration cluster.                                                                                                                                                              | Same value as used on the cluster for [`ZEEBE_BROKER_CLUSTER_CLUSTERSIZE`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                         |
| `CAMUNDA_MIGRATION_IDENTITY_CLUSTER_PARTITIONSCOUNT`             | Partition count of the Orchestration cluster.                                                                                                                                                   | Same value as used on the cluster for [`ZEEBE_BROKER_CLUSTER_PARTITIONSCOUNT`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                     |
| `CAMUNDA_MIGRATION_IDENTITY_CLUSTER_REPLICATIONFACTOR`           | Replication factor of the Orchestration cluster.                                                                                                                                                | Same value as used on the cluster for [`ZEEBE_BROKER_CLUSTER_REPLICATIONFACTOR`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                   |
| `CAMUNDA_MIGRATION_IDENTITY_CLUSTER_INITIALCONTACTPOINTS`        | List of known cluster hosts within the Orchestration cluster.                                                                                                                                   | Same value as used on the cluster for [`ZEEBE_BROKER_CLUSTER_INITIALCONTACTPOINTS`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                |
| `CAMUNDA_MIGRATION_IDENTITY_MANAGEMENTIDENTITY_AUDIENCE`         | The audience for accessing the [Management Identity](../management-identity/overview.md) API                                                                                                    | In case of a default Keycloak setup, it is `camunda-identity-resource-server`, in case of [OIDC, it is user defined](../../components/management-identity/configuration/connect-to-an-oidc-provider.md).                                                     |
| `CAMUNDA_MIGRATION_IDENTITY_MANAGEMENTIDENTITY_BASEURL`          | The URL under which [Management Identity](../management-identity/overview.md) can be accessed by the Identity Migration Application                                                             | Must be a valid absolute URL to the [Management Identity](../management-identity/overview.md) server, e.g. `http://management-identity:8080`.                                                                                                                |
| `CAMUNDA_MIGRATION_IDENTITY_MANAGEMENTIDENTITY_CLIENTID`         | The client id for accessing [Management Identity](../management-identity/overview.md).                                                                                                          | The clientId set requires to have the `read` permission granted for the `Camunda Identity Resource Server` API in [Management Identity](../../components/management-identity/access-management/access-management-overview.md#permissions)                    |
| `CAMUNDA_MIGRATION_IDENTITY_MANAGEMENTIDENTITY_CLIENTSECRET`     | The client secret for accessing [Management Identity](../management-identity/overview.md).                                                                                                      | Matching secret for configured clientId.                                                                                                                                                                                                                     |
| `CAMUNDA_MIGRATION_IDENTITY_MANAGEMENTIDENTITY_ISSUERBACKENDURL` | The URL under which the Token Issuer can be accessed.                                                                                                                                           | Use the same as used by Management Identity for [`CAMUNDA_IDENTITY_ISSUER_BACKEND_URL`](../../components/management-identity/configuration/connect-to-an-oidc-provider.md#configuration).                                                                    |

  </TabItem>
  <TabItem value="application.yaml" label="application.yaml">

| Application.yaml property                                           | Description                                                                                                                                                                                     | Required value                                                                                                                                                                                                                                               |
| ------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `camunda.migration.identity.mode`                                   | Mode of the migration app.                                                                                                                                                                      | In case of the [Camunda Identity 8.7 default (Keycloak)](../management-identity/overview.md) setup: `KEYCLOAK`. <br></br> In case of the [Camunda Identity 8.7 with OIDC](../management-identity/configuration/connect-to-an-oidc-provider.md) setup: `OIDC` |
| `camunda.migration.identity.resource-authorizations-enabled`        | Signals whether [Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md) were used in the 8.7, defaults to `false`. | Must be `true` in case [Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md) were used.                                                                                       |
| `camunda.migration.identity.cluster.cluster-name`                   | Name of the Orchestration cluster.                                                                                                                                                              | Same value as used on the cluster for [`zeebe.broker.cluster.cluster-name`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                        |
| `camunda.migration.identity.cluster.cluster-size`                   | Size of the Orchestration cluster.                                                                                                                                                              | Same value as used on the cluster for [`zeebe.broker.cluster.cluster-size`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                        |
| `camunda.migration.identity.cluster.partitions-count`               | Partition count of the Orchestration cluster.                                                                                                                                                   | Same value as used on the cluster for [`zeebe.broker.cluster.partitions-count`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                    |
| `camunda.migration.identity.cluster.replication-factor`             | Replication factor of the Orchestration cluster.                                                                                                                                                | Same value as used on the cluster for [`zeebe.broker.cluster.replication-factor`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                                  |
| `camunda.migration.identity.cluster.initial-contact-points`         | List of known cluster hosts within the Orchestration cluster.                                                                                                                                   | Same value as used on the cluster for [`zeebe.broker.cluster.initial-contact-points`](../../components//orchestration-cluster/zeebe/configuration/broker.md#zeebebrokercluster)                                                                              |
| `camunda.migration.identity.management-identity.audience`           | The audience for accessing the [Management Identity](../management-identity/overview.md) API                                                                                                    | In case of a default Keycloak setup, it is `camunda-identity-resource-server`, in case of [OIDC, it is user defined](../../components/management-identity/configuration/connect-to-an-oidc-provider.md).                                                     |
| `camunda.migration.identity.management-identity.base-url`           | The URL under which [Management Identity](../management-identity/overview.md) can be accessed by the Identity Migration Application                                                             | Must be a valid absolute URL to the [Management Identity](../management-identity/overview.md) server, e.g. `http://management-identity:8080`.                                                                                                                |
| `camunda.migration.identity.management-identity.client-id`          | The client id for accessing [Management Identity](../management-identity/overview.md).                                                                                                          | The clientId set requires to have the `read` permission granted for the `Camunda Identity Resource Server` API in [Management Identity](../../components/management-identity/access-management/access-management-overview.md#permissions)                    |
| `camunda.migration.identity.management-identity.client-secret`      | The client secret for accessing [Management Identity](../management-identity/overview.md).                                                                                                      | Matching secret for configured clientId.                                                                                                                                                                                                                     |
| `camunda.migration.identity.management-identity.issuer-backend-url` | The URL under which the Token Issuer can be accessed.                                                                                                                                           | Use the same as used by Management Identity for [`CAMUNDA_IDENTITY_ISSUER_BACKEND_URL`](../../components/management-identity/configuration/connect-to-an-oidc-provider.md#configuration).                                                                    |

  </TabItem>
</Tabs>

### Manual migration instructions

#### Roles & Application Permissions

Permissions formerly assigned to [Management Identity Roles](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/manage-permissions.md#assign-a-permission-to-a-role) and [Management Identity Applications](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/manage-permissions.md#assign-a-permission-to-an-application) require the following equivalent [Orchestration Cluster Identity Authorizations](../../../components/identity/authorization.md) setup.

You need to manually recreate the [Roles](../../../components/identity/role.md) you need and grant them the equivalent Authorizations for the former [Management Identity Permission](../management-identity/access-management/access-management-overview.md) as follows:

<table>
  <tr>
    <th colspan="2">[Management Identity Permission](../management-identity/access-management/access-management-overview.md)</th>
    <th colspan="3">Equivalent [Camunda Orchestration Cluster 8.8 Authorizations](../../../components/identity/authorization.md)</th>
  </tr>
  <tr>
    <th>Component</th>
    <th>Permission</th>
    <th>Resource Type</th>
    <th>Resource ID</th>
    <th>Permission(s)</th>
  </tr>
  <!-- operate-api:read -->
  <tr>
    <td rowspan="12">Operate</td>
    <td rowspan="6">read</td>
    <td>`BATCH`</td>
    <td>`*`</td>
    <td>`READ`</td>
  </tr>
    <tr>
    <td>`COMPONENT`</td>
    <td>`Operate`</td>
    <td>`ACCESS`</td>
  </tr>
  <tr>
    <td>`MESSAGE`</td>
    <td>`*`</td>
    <td>`READ`</td>
  </tr>
  <tr>
    <td>`PROCESS_DEFINITION`</td>
    <td>`*`</td>
    <td>`READ_PROCESS_DEFINITION`, `READ_PROCESS_INSTANCE`</td>
  </tr>
  <tr>
    <td>`DECISION_DEFINITION`</td>
    <td>`*`</td>
    <td>`READ_DECISION_DEFINITION`, `READ_DECISION_INSTANCE`</td>
  </tr>
  <tr>
    <td>`DECISION_REQUIREMENTS_DEFINITION`</td>
    <td>`*`</td>
    <td>`READ`</td>
  </tr>
  <!-- operate-api:write -->
  <tr>
    <td rowspan="6">write</td>
    <td>`BATCH`</td>
    <td>`*`</td>
    <td>`CREATE`, `READ`, `UPDATE`</td>
  </tr>
    <tr>
    <td>`COMPONENT`</td>
    <td>`Operate`</td>
    <td>`ACCESS`</td>
  </tr>
  <tr>
    <td>`RESOURCE`</td>
    <td>`*`</td>
    <td>`DELETE_FORM`, `DELETE_PROCESS`, `DELETE_DRD`, `DELETE_RESOURCE`</td>
  </tr>
  <tr>
    <td>`PROCESS_DEFINITION`</td>
    <td>`*`</td>
    <td>`READ_PROCESS_DEFINITION`, `READ_PROCESS_INSTANCE`, `DELETE_PROCESS_INSTANCE`, `UPDATE_PROCESS_INSTANCE`, `MODIFY_PROCESS_INSTANCE` `CANCEL_PROCESS_INSTANCE`</td>
  </tr>
  <tr>
    <td>`DECISION_DEFINITION`</td>
    <td>`*`</td>
    <td>`READ_DECISION_DEFINITION`, `READ_DECISION_INSTANCE`, `CREATE_DECISION_INSTANCE`, `DELETE_DECISION_INSTANCE`</td>
  </tr>
  <tr>
    <td>`DECISION_REQUIREMENTS_DEFINITION`</td>
    <td>`*`</td>
    <td>`READ`, `UPDATE`, `DELETE`</td>
  </tr>
  <!-- tasklist-api:read -->
  <tr>
    <td rowspan="4">Tasklist</td>
    <td rowspan="2">read</td>
    <td><code>COMPONENT</code></td>
    <td><code>Tasklist</code></td>
    <td><code>ACCESS</code></td>
  </tr>
  <tr>
    <td><code>PROCESS_DEFINITION</code></td>
    <td><code>*</code></td>
    <td><code>READ_PROCESS_DEFINITION</code>, <code>READ_USER_TASK</code></td>
  </tr>
  <!-- tasklist-api:write -->
  <tr>
    <td rowspan="2">write</td>
    <td><code>COMPONENT</code></td>
    <td><code>Tasklist</code></td>
    <td><code>ACCESS</code></td>
  </tr>
  <tr>
    <td><code>PROCESS_DEFINITION</code></td>
    <td><code>*</code></td>
    <td><code>READ_PROCESS_DEFINITION</code>, <code>READ_USER_TASK</code>, <code>UPDATE_USER_TASK</code></td>
  </tr>
  <!-- camunda-identity-resource-server:read -->
  <tr>
    <td rowspan="15">Identity</td>
    <td rowspan="6">read</td>
    <td><code>AUTHORIZATIONS</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <tr>
    <td><code>COMPONENT</code></td>
    <td><code>Identity</code></td>
    <td><code>ACCESS</code></td>
  </tr>
  <tr>
    <td><code>GROUP</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <tr>
    <td><code>ROLES</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <tr>
    <td><code>TENANTS</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <tr>
    <td><code>USERS</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <!-- camunda-identity-resource-server:read:users -->
  <tr>
    <td rowspan="3">read:users</td>
    <td><code>COMPONENT</code></td>
    <td><code>Identity</code></td>
    <td><code>ACCESS</code></td>
  </tr>
  <tr>
    <td><code>USERS</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <tr>
    <td><code>ROLES</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
  <!-- camunda-identity-resource-server:write -->
  <tr>
    <td rowspan="6">write</td>
    <td><code>AUTHORIZATIONS</code></td>
    <td><code>*</code></td>
    <td><code>CREATE</code>, <code>READ</code>, <code>UPDATE</code>, <code>DELETE</code></td>
  </tr>
  <tr>
    <td><code>COMPONENT</code></td>
    <td><code>Identity</code></td>
    <td><code>ACCESS</code></td>
  </tr>
  <tr>
    <td><code>GROUP</code></td>
    <td><code>*</code></td>
    <td><code>CREATE</code>, <code>READ</code>, <code>UPDATE</code>, <code>DELETE</code></td>
  </tr>
  <tr>
    <td><code>ROLES</code></td>
    <td><code>*</code></td>
    <td><code>CREATE</code>, <code>READ</code>, <code>UPDATE</code>, <code>DELETE</code></td>
  </tr>
  <tr>
    <td><code>TENANTS</code></td>
    <td><code>*</code></td>
    <td><code>CREATE</code>, <code>READ</code>, <code>UPDATE</code>, <code>DELETE</code></td>
  </tr>
  <tr>
    <td><code>USERS</code></td>
    <td><code>*</code></td>
    <td><code>READ</code></td>
  </tr>
</table>

##### User Role membership

You can recreate [Management Identity Role memberships](../management-identity/application-user-group-role-management/manage-roles.md) using the [Orchestration Cluster Identity Role Management](../../../components/identity/role.md#assign-users-to-a-role).

#### Groups

You can recreate Groups setup in the [Management Identity Groups](../management-identity/application-user-group-role-management/manage-groups.md) using the [Orchestration Cluster Identity Group Management](../../../components/identity/group.md).

Alernatively you can make use of the [Bring your own Groups feature](../../../self-managed/components/orchestration-cluster/identity/connect-external-identity-provider.md#optional-step-8-configure-bring-your-own-groups) and just recreate the [Orchestration Cluster Authorization Records](../../../components/identity/authorization.md) granting permissions to those groups. This is what the Identity Migration Application defaults to.

#### Resource Authorizations

The former [Management Identity Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md) are replaced with a more fine grained [Orchestration Cluster Authorization Management](../../../components/identity/authorization.md). The following table lists the equivalent authorization records to create, to represent for a former [Management Identity Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md).

<table>
  <tr>
    <th colspan="2">[Management Identity Resource Authorizations](../../../../versioned_docs/version-8.7/self-managed/identity/access-management/resource-authorizations.md)</th>
    <th colspan="2">Equivalent [Camunda Orchestration Cluster 8.8 Authorizations](../../../components/identity/authorization.md)</th>
  </tr>
  <tr>
    <th>Resource Type</th>
    <th>Permission</th>
    <th>Resource Type</th>
    <th>Permission(s)</th>
  </tr>
  <tr>
    <td><code>PROCESS</code></td>
    <td><code>Read</code></td>
    <td><code>PROCESS_DEFINITION</code></td>
    <td><code>READ_PROCESS_DEFINITION</code>, <code>READ_PROCESS_INSTANCE</code></td>
  </tr>
  <tr>
    <td><code>PROCESS</code></td>
    <td><code>Delete</code></td>
    <td><code>RESOURCE</code></td>
    <td><code>DELETE_PROCESS</code></td>
  </tr>
  <tr>
    <td><code>PROCESS</code></td>
    <td><code>Update process instance</code></td>
    <td><code>PROCESS_DEFINITION</code></td>
    <td><code>UPDATE_PROCESS_INSTANCE</code></td>
  </tr>
  <tr>
    <td><code>PROCESS</code></td>
    <td><code>Delete process instance</code></td>
    <td><code>PROCESS_DEFINITION</code></td>
    <td><code>DELETE_PROCESS_INSTANCE</code></td>
  </tr>
  <tr>
    <td><code>PROCESS</code></td>
    <td><code>Start process instance</code></td>
    <td><code>PROCESS_DEFINITION</code></td>
    <td><code>CREATE_PROCESS_INSTANCE</code></td>
  </tr>
  <tr>
    <td><code>DECISION</code></td>
    <td><code>Read</code></td>
    <td><code>DECISION_DEFINITION</code></td>
    <td><code>READ_DECISION_DEFINITION</code>, <code>READ_DECISION_INSTANCE</code></td>
  </tr>
  <tr>
    <td><code>DECISION</code></td>
    <td><code>Delete</code></td>
    <td><code>RESOURCE</code></td>
    <td><code>DELETE_DRD</code></td>
  </tr>
</table>

#### Tenants

You can recreate [Management Identity Tenants](../../../../versioned_docs/version-8.7/self-managed/identity/managing-tenants.md) using the [Orchestration Cluster Identity Tenant Management](../../../components/identity/tenant.md).

#### Mapping Rules

You can recreate [Management Identity Mapping Rules](../../../../versioned_docs/version-8.7/self-managed/identity/mapping-rules.md) using the [Orchestration Cluster Identity Mapping Rule Management](../../../components/identity/mapping-rules.md).

## Camunda Exporter and harmonized data model

The following Camunda 8.7 to 8.8 update guide covers changes related to the new harmonized data model, and the newly introduced [Camunda Exporter](/self-managed/components/orchestration-cluster/zeebe/exporters/camunda-exporter.md).
For additional details about the introduced exporter and related changes, see the [8.8 announcements](/reference/announcements-release-notes/880/880-announcements.md).

:::important
With the Camunda Exporter introduction, Camunda is compatible with Elasticsearch 8.16+ and no longer supports older Elasticsearch versions. See [supported environments](/reference/supported-environments.md).
:::

### Ensure the exporter/import backlog is small

For data from 8.7 to be imported, the importers must run first and complete before the Camunda Exporter can start.

The importer reads data from existing Zeebe Elasticsearch indices, and when it detects data from newer versions, it marks itself as complete. The Camunda Exporter then starts exporting only when the importer is done.

:::important
To reduce the potential of building a backlog, the user needs to make sure to drain the backlog queue as much as possible before the update.

Otherwise, the backlog can increase and cause web application data to become out of date. Zeebe
will be not able to clean up data, potentially running out of disc space. This will produce downtime.
:::

The backlog can be validated via the following Prometheus metrics:

- `operate_import_time_seconds_sum`
- `operate_import_time_seconds_count`

For example, the following query shows the import latency. If the result is in a range of seconds (ideally below 10 seconds), it is fine to update.

```promql
sum(rate(operate_import_time_seconds_sum{namespace=~"$namespace", partition=~"$partition", pod=~"$pod"}[$__rate_interval]))
/ sum(rate(operate_import_time_seconds_count{namespace=~"$namespace", partition=~"$partition", pod=~"$pod"}[$__rate_interval]))
```

### Data migration

Camunda 8.8 provides dedicated migration applications to help ensure seamless compatibility and data integrity when upgrading. Note that upgrades must be performed sequentially through each minor version (for example, from 8.6 → 8.7 → 8.8), as skipping versions is not supported.

The migration applications are located in the `camunda/bin/` directory. You can run them locally, targeting the same
Elasticsearch or OpenSearch instance, either as standalone tools or alongside the rest of the Camunda 8 application. You can also use the `data-migration` binary that wraps all the migrations in a single application (excluding `identity-migration`),

Data migration execution requires the presence of the secondary storage [configuration(this will point to the correct place once docs are completed)](#configuration). Apart from that, all migrations share the same base configuration but they can be individually tuned depending on your needs. Prometheus metrics are exposed for the migration progress under `:9600/actuator/prometheus` endpoint.

Details regarding each of the migrations can be found bellow.

<Tabs groupId="migrations" defaultValue="process" values={
[
{ label: 'Process Migration', value: 'process', },
{ label: 'Task Migration', value: 'tasklist', },
{ label: 'Metrics Migration', value: 'metrics', },
] }>

<TabItem value="process">

#### Scope

The process migration component is responsible for unifying the previous separate indices of `operate-process` and `tasklist-process`. To achieve that, it's mandatory to extract the Camunda Form related data that are present on the deployments, but only relevant to Tasklist up to now.

_Depends on Operate importer being completed._

#### Configuration

Spring profile: `process-migration`

```yaml
camunda:
  migration:
    process:
      # How many process definitions are processed per round
      # Default 20
      batchSize: 5
      # The timeout/count down after importer has finished before the migration app should stop
      # Default PT1M
      importerFinishedTimeout: PT1M
      # The timeout for the migration
      # Default PT2H
      timeout: PT2H
      # Retry properties, exponential backoff
      retry:
        # How many times do we retry failing operations until we stop the migration process
        maxRetries: 5
        # The minimum retry delay applied to backoff
        # Default PT1S
        minRetryDelay: PT10S
        # The maximum retry delay applied to backoff
        # Default PT1M
        maxRetryDelay: PT1M
```

#### Exposed Metrics

- `camunda_migration_processes_migrated` - Number of migrated processes so far
- `camunda_migration_processes_rounds` - Number of migration rounds performed so far
- `camunda_migration_processes_round_time` - Time taken to complete one migration round
- `camunda_migration_processes_single_process_time` - Time taken to process a single process definition

</TabItem>

<TabItem value="tasklist">

#### Scope

This migration component is responsible for migrating the `tasklist-task` runtime and dated indices to remove the `dynamic:true` requirement on `tasklist-task.customHeaders` field mapping.

:::note
This migration will also version bump all the `tasklist-task` indices to 8.8.0 except for the runtime one which for data safety reasons will remain. If cluster retention is enabled, an ILM/ISM policy will be applied to the runtime index for the desired amount of days (default 30)
:::

_Depends on Tasklist importer being completed._

##### Side effects

As this migration actively moves data from indices, there are some temporary side effects that can, potentially, be observed in the Orchestration Cluster:

- Some tasks may not be visible in the Tasklist UI or be returned by the Tasklist API.
- When using **Tasklist API v1**, some tasks cannot be assigned, unassigned, or completed. These requests return a `404 Not Found` response.
- When using **Tasklist API v2**, tasks can be assigned, unassigned, or completed, but attempts to retrieve them (e.g., via search) may return a `500 Internal Server Error` response.
- Refreshing the Tasklist UI while a task is selected may return `404 Not Found` if the task is still being migrated.
- Refreshing the Tasklist UI while a task is selected may return `500 Internal Server Error` if the task was completed or reassigned via API v2 but not yet fully migrated.
- Archiving is disabled during this period

These will be automatically resolved when the migration is completed.

#### Configuration

Spring profile: `task-migration`

```yaml
camunda:
  migration:
    tasks:
      # How many tasks are processed per round
      # Default 20
      batchSize: 20
      # Retention age for the old `tasklist-task-8.5.0` runtime index. Applies only if global retention is enabled
      # Default 30d
      legacyIndexRetentionAge: 30d
      # Retry properties, exponential backoff
      retry:
        # How many times do we retry failing operations until we stop the migration process
        maxRetries: 5
        # The minimum retry delay applied to backoff
        # Default PT1S
        minRetryDelay: PT10S
        # The maximum retry delay applied to backoff
        # Default PT1M
        maxRetryDelay: PT1M
```

#### Exposed Metrics

- `camunda_migration_tasks_migrated` - Number of tasks processed so far
- `camunda_migration_tasks_rounds` - Total number of task batch update rounds
- `camunda_migration_tasks_round_time` - Time taken for migrating a task batch
- `camunda_migration_tasks_single_task_time` - Time taken to process a single task

</TabItem>
<TabItem value="metrics">

#### Scope

This migration component is responsible for migrating existing usage metrics from Operate and Tasklist into the new data structure of the respective new indices.

This migration consists of two parts, Operate metrics and Tasklist usage metrics, referenced as `metrics` and `tu-metrics` in the configuration respectively.

_Each of the migrations depend on the respective importer being completed._

#### Configuration

Spring profile: `usage-metric-migration`

```yaml
camunda:
  migration:
    metrics:
      # The timeout for the migration
      # Default PT2H
      timeout: PT2H
      # Retry properties, exponential backoff
      retry:
        # How many times do we retry failing operations until we stop the migration process
        maxRetries: 5
        # The minimum retry delay applied to backoff
        # Default PT1S
        minRetryDelay: PT10S
        # The maximum retry delay applied to backoff
        # Default PT1M
        maxRetryDelay: PT1M
    tu-metrics:
      # The timeout for the migration
      # Default PT2H
      timeout: PT2H
      # Retry properties, exponential backoff
      retry:
        # How many times do we retry failing operations until we stop the migration process
        maxRetries: 5
        # The minimum retry delay applied to backoff
        # Default PT1S
        minRetryDelay: PT10S
        # The maximum retry delay applied to backoff
        # Default PT1M
        maxRetryDelay: PT1M
```

#### Exposed Metrics

- `camunda_migration_operate_reindex_time` - Time taken to reindex Operate's metrics index
- `camunda_migration_operate_task_importer_finished` - Time taken for Operate's importer to be finished
- `camunda_migration_tasklist_reindex_time` - Time taken to reindex Tasklist's metrics index
- `camunda_migration_tasklist_task_importer_finished` - Time taken for Tasklist's importer to be finished

</TabItem>
</Tabs>

---

#### Standalone Migration (locally)

When running the application separately (locally for example), the configuration must be made public to the migration application.

For example, the location of the `application.yaml` can be provided for local execution:

```shell
SPRING_CONFIG_ADDITIONALLOCATION=/path/to/application.yaml ./camunda/bin/process-migration
```

#### Integration in the standalone Camunda application

When running the standalone Camunda application, any migration application can be executed inside. It can be enabled via the respective Spring profile.

**Example Spring profile configuration:**

```yaml
spring:
  profiles:
    active: "operate,tasklist,broker,process-migration,task-migration,usage-metrics-migration"
```

:::note
The above configuration must be made in the related `application.yaml` of the standalone Camunda application.
:::

### Turn off importers after completion

:::note
In 8.8, the Operate and Tasklist importers are disabled by default.  
When upgrading, enable them by setting:

- `camunda.operate.importerEnabled=true`
- `camunda.tasklist.importerEnabled=true`
  :::

Importers are only necessary at the start of the migration. Once complete, they can be safely turned off.

To detect whether importers are done, users can validate the state in the Elasticsearch/OpenSearch index:

- `tasklist-import-position-8.2.0_`
- `operate-import-position-8.3.0_`

If all entries show the `completed` property set to `true`, the importing is done.

Alternatively, metrics can be validated via:

- `operate_import_completed`
- `tasklist_import_completed`

These properties can be used in the following example query:

```
sum(tasklist_import_completed{namespace="$namespace"}) by (importPositionAlias)
```

![metrics-import-complete](./img/import-complete-metrics.png)

:::note
When using the Camunda 8 Helm charts, the migration application will be automatically deployed as a Kubernetes Job alongside a deployment for Tasklist and Operate Importers,
if the upgrade path is selected. Identifying when the Importers are no longer useful and can be scaled down is based in the completion of the `data-migration` Kubernetes Job.
:::

### Update any custom prefixes

:::important
This step is required if your installation consists of custom prefixed indices.
:::

The new harmonized index schema introduces one common index prefix. To update to Camunda 8.8, existing indices using custom prefixes must be migrated to a common prefix, so the Camunda Exporter, REST API, and other consumers can be configured correctly.

#### Prefix migration

:::caution
Prefix migration modifies the secondary storage in preparation for the Camunda 8.8 update. The changes are irreversible, therefore, a cluster backup is required. For data integrity prefix migration requires downtime, as all data in the secondary storage needs to be migrated to a different prefix and no access to the Camunda indices should take place during that time window. **Do not restart the cluster on the previous Camunda 8.7 version.**
:::

Complete the following steps to migrate any custom prefixes:

1. Shut down your Camunda 8.7 cluster (for example, reduce the replicas to zero). No traffic can be executed against your to-be-migrated ES/OS prefixes.
2. In the `camunda/bin` directory, the `prefix-migration` script will execute the prefix migration, which can be executed locally.

   1. Make sure that your configuration in `camunda/config` has set the previous custom prefixes, and your configuration is made public to the script (for example, using `SPRING_CONFIG_ADDITIONALLOCATION=/path/to/application.yaml ./camunda/bin/prefix-migration`).
   2. Alternatively, you can set the configuration via environment variables

   In both cases follow the configuration instructions for the secondary storage of your choice and supply the respective values for Tasklist and Operate index prefixes.

Example execution of the prefix migration:
<Tabs groupId="prefix-db" defaultValue="elasticsearch" values={
[
{ label: 'Elasticsearch', value: 'elasticsearch', },
{ label: 'OpenSearch', value: 'opensearch', },
] }>
<TabItem value="elasticsearch">

```shell
export CAMUNDA_OPERATE_ELASTICSEARCH_INDEX_PREFIX=old-operate-prefix ;\
export CAMUNDA_TASKLIST_ELASTICSEARCH_INDEX_PREFIX=old-tasklist-prefix ;\
export CAMUNDA_DATA_SECONDARYSTORAGE_ELASTICSEARCH_INDEXPREFIX=some-new-prefix ;\
export CAMUNDA_DATA_SECONDARYSTORAGE_ELASTICSEARCH_URL=http://localhost:9200 ;\
export CAMUNDA_DATA_SECONDARYSTORAGE_TYPE=elasticsearch ;\
./bin/prefix-migration
```

</TabItem>
<TabItem value="opensearch">
   ```shell
  export CAMUNDA_OPERATE_OPENSEARCH_INDEX_PREFIX=old-operate-prefix ;\
  export CAMUNDA_TASKLIST_OPENSEARCH_INDEX_PREFIX=old-tasklist-prefix ;\
  export CAMUNDA_DATA_SECONDARYSTORAGE_OPENSEARCH_INDEXPREFIX=some-new-prefix ;\
  export CAMUNDA_DATA_SECONDARYSTORAGE_OPENSEARCH_URL=http://localhost:9200 ;\
  export CAMUNDA_DATA_SECONDARYSTORAGE_TYPE=opensearch ;\
  ./bin/prefix-migration
   ```
</TabItem>

</Tabs>

:::note
In case custom prefix is only supplied for one of Tasklist or Operate, supply on the respective required `CAMUNDA_TASKLIST/OPERATE_ELASTICSEARCH_INDEX_PREFIX`
:::

With the completion of the Prefix migration, your secondary storage will be capable of proceed with the update to Camunda 8.8.

With the migration finished, the following configuration changes must be made prior to updating to 8.8.

:::note
Without these configuration changes, the update to 8.8 will fail.
:::

Given a new desired prefix of `some-new-prefix`:

- Set `CAMUNDA_OPERATE_ELASTICSEARCH_INDEX_PREFIX` to `some-new-prefix`.
- Set `CAMUNDA_TASKLIST_ELASTICSEARCH_INDEX_PREFIX` to `some-new-prefix`.
- Set `ZEEBE_BROKER_EXPORTERS_CAMUNDA_ARGS_CONNECT_INDEXPREFIX` (the prefix for the new [Camunda exporter](/self-managed/components/orchestration-cluster/zeebe/exporters/camunda-exporter.md)) to `some-new-prefix`.

### Single Elasticsearch/OpenSearch instance

Using more than one isolated Elasticsearch/OpenSearch instance for exported Zeebe, Operate, and Tasklist data is no longer supported. If your environment uses multiple Elasticsearch/OpenSearch instances, you must manually migrate the data from each to a single Elasticsearch/OpenSearch cluster before updating to Camunda 8.8. The migration should target Zeebe, Operate, and Tasklist indices, index templates, aliases, and ILM policies.

:::important
This step must be performed before all other migration steps.
:::

## Orchestration Cluster REST API

### Removed deprecated OpenAPI objects

:::warning
With the Camunda 8.8 release, deprecated API objects containing number keys have been removed, including the
corresponding `application/vnd.camunda.api.keys.number+json` content type header.
:::

In previous releases, entity keys were transitioned from `integer (int64)` to `string` types, and deprecated
`integer (int64)` keys were still supported. As of the 8.8 release, support for `integer (int64)` keys has been removed.

To update to Camunda 8.8, API objects using `integer (int64)` keys must be updated to use `string` keys and the
`application/json` header.

For more information about the key attribute type change, see
the [8.7 API key attributes overview][camunda8-api-overview].

[camunda8-api-overview]: /versioned_docs/version-8.7/apis-tools/camunda-api-rest/camunda-api-rest-overview.md#api-key-attributes

### Streamlined variable OpenAPI objects

The OpenAPI specification streamlines the objects used for variable filtering in search requests. The supported Camunda Java client handles those changes transparently. The affected API endpoints are alpha feature endpoints and thus already marked as subject to change in 8.6 and 8.7.

If you are generating a custom REST client using the specification, consider the following changes:

- The unified `VariableValueFilterProperty` replaces the `ProcessInstanceVariableFilterRequest` and `UserTaskVariableFilterRequest` in the OpenAPI spec.
- For naming consistency, the `UserTaskVariableFilter` replaces the `VariableUserTaskFilterRequest`.

## Exported records

### `USER_TASK` records

To support [user task listeners](/components/concepts/user-task-listeners.md), some backward incompatible changes were necessary to the exported `USER_TASK` records.

#### `assignee` no longer provided in `CREATED` event

Previously, when a user task was activating with a specified `assignee`,
we appended the following events of the `USER_TASK` value type:

- `CREATING` with `assignee` property as provided
- `CREATED` with `assignee` property as provided

The `ASSIGNING` and `ASSIGNED` events were not appended in this case.

To support the new User Task Listeners feature, the `assignee` value will not be filled in the `CREATED` event anymore.

With 8.8, the following events are now appended:

- `CREATING` with `assignee` property as provided
- `CREATED` with `assignee` always `""` (empty string)
- `ASSIGNING` with `assignee` property as provided
- `ASSIGNED` with `assignee` property as provided

#### `ASSIGNING` has become `CLAIMING` for `CLAIM` operation

When claiming a user task, we previously appended the following records of the `USER_TASK` value type:

- `CLAIM`
- `ASSIGNING`
- `ASSIGNED`

A new `CLAIMING` intent was introduced to distinguish between claiming and regular assigning.
We now append the following records when claiming a user task:

- `CLAIM`
- `CLAIMING`
- `ASSIGNED`

The `ASSIGNING` event is still appended for assigning a user task.
In that case, we append the following records:

- `ASSIGN`
- `ASSIGNING`
- `ASSIGNED`

### Zeebe record types

With the introduction of the Camunda Exporter, the Elasticsearch and OpenSearch Exporter no longer export all record types by default. Therefore, not all `zeebe-record` indices will be populated.

:::note
This only affects records exported with the 8.8 version. During the migration, leftover 8.7 records are exported as normal.
:::

The record types that continue to be exported by default are the following:

- `DEPLOYMENT`
- `PROCESS`
- `PROCESS_INSTANCE`
- `VARIABLE`
- `USER_TASK`
- `INCIDENT`
- `JOB`

To export other record types, review `includeEnabledRecords` for [Elasticsearch](../orchestration-cluster/zeebe/exporters/elasticsearch-exporter.md#configuration) or [OpenSearch](../orchestration-cluster/zeebe/exporters/opensearch-exporter.md#configuration) exporter configuration.

### Exporter deletion

Exporter configuration removal no longer deletes the exporter from the system. Instead, the exporter enters a blocked state to safeguard against data loss caused by accidental or manual configuration changes. To permanently remove an exporter, use the [Exporters API](/self-managed/components/orchestration-cluster/zeebe/operations/management-api.md).

## Connectors

### Email connector

Starting with the 8.8 release, angle brackets (`<` and `>`) are no longer removed from the `messageId`.

## Elasticsearch

Starting in 8.8, the default replica count for Camunda indices in Elasticsearch and OpenSearch changes from 0 to 1.
This ensures that if a node goes down, Camunda is not blocked by a temporary outage of the secondary data store.

If you already override this value, no action is required. Otherwise, review the guidance below to adjust capacity or revert the change.

Throughout this section, references to Elasticsearch (ES) also apply to OpenSearch (OS). For simplicity, ES is used as the default term.

### Single-node cluster

If the current ES cluster has only one node, setting the replica value to 1 will cause the cluster state to go yellow.  
This means all primary shards are allocated, but some replicas are unassigned.

To resolve this issue:

- Increase the number of master-eligible nodes to at least 2.
- Refer to the [Bitnami Elasticsearch Helm chart values](https://artifacthub.io/packages/helm/bitnami/elasticsearch/21.6.3), specifically the `master.replicaCount` field.

  ⚠️ **Important:** Bitnami recommends scaling the ES cluster down first for consistency reasons. Follow their guidance carefully.

- See [Elastic Cloud: Resize deployment](https://www.elastic.co/docs/deploy-manage/deploy/cloud-enterprise/resize-deployment).

:::note
If you install Elasticsearch using the Camunda Helm chart, the default `master.replicaCount` is `3`, resulting in a three-node cluster.  
For other setups, you can apply the same logic by setting `elasticsearch.master.replicaCount`.
:::

Once complete, continue with [Multi-node cluster](#multi-node-cluster).

### Multi-node cluster

Starting in 8.8, the default replica count for indices is 1. If your cluster previously used a replica count of 0, this will roughly double disk usage.

To ensure the ES cluster can reach a green status, make sure the disk capacity is at least 2.5× the previously used storage.  
This calculation accounts for watermarks, overhead, and growth.

For example:

- In 8.7, node disk usage is 30/50 GB, 35/50 GB, and 40/50 GB.
- The most used node has 40 GB.
- To ensure replicas fit on other nodes, resize all disks to at least 100 GB (40 × 2.5).

#### Resize Elasticsearch disk

If the current disk size is too small for replicas, assign more disk space. Whether a Persistent Volume Claim (PVC) is expandable depends on the underlying `StorageClass`.

For information on expanding PVCs using the calculations above, see:

- [Kubernetes: Expanding persistent volume claims](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#expanding-persistent-volumes-claims)
- [Kubernetes: Storage classes and volume expansion](https://kubernetes.io/docs/concepts/storage/storage-classes/#allow-volume-expansion)

For managed services, see:

- [Elastic Cloud: Fix master nodes out of disk](https://www.elastic.co/docs/troubleshoot/elasticsearch/fix-master-node-out-of-disk)
- [AWS OpenSearch: Modifying an EBS Volume](https://docs.aws.amazon.com/ebs/latest/userguide/ebs-modify-volume.html)  
  (relevant because AWS OpenSearch is backed by EBS volumes)

### Roll back

If you encounter issues after the upgrade and replica increase, revert the replica count to 0 in the Zeebe deployment and restart.  
Zeebe pods will trigger the processes which update the indices back to 0 replicas.

Set one of the following:

- YAML: `camunda.database.index.numberOfReplicas: 0`
- Env var: `CAMUNDA_DATABASE_INDEX_NUMBER_OF_REPLICAS=0`
