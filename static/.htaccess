# Welcome to the redirect party!
#  ____  ____  ____  __  ____  ____  ___  ____    ____   __   ____  ____  _  _  _
# (  _ \(  __)(    \(  )(  _ \(  __)/ __)(_  _)  (  _ \ / _\ (  _ \(_  _)( \/ )/ \
#  )   / ) _)  ) D ( )(  )   / ) _)( (__   )(     ) __//    \ )   /  )(   )  / \_/
# (__\_)(____)(____/(__)(__\_)(____)\___) (__)   (__)  \_/\_/(__\_) (__) (__/  (_)
#
# Please read this guide before adding new redirects.
#
##################################################################################
#
# Redirects in this file are sorted in this order:
#  1. Universal rules that pertain to all content.
#     These redirects have no anticipated removal.
#  2. Broad version (or unversioned) redirects.
#     These redirects have no anticipated removal.
#  3. Specific content moves, in newest-to-oldest order of version in which they are introduced.
#     These redirects will be removed when their introduced version is no longer supported.
#
#  If you're adding a redirect for a specific page or section,
#   you likely want to do that in #3.
#  That means that you want to find the banner comment identifying that version,
#    and add your redirect below that comment.
#
# For help writing rules, see https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewriterule.
#
##################################################################################

##################################################################################
# 1. Universal rules
##################################################################################

# Redirect to https
RewriteEngine on
RewriteCond %{SERVER_PORT} !^443$
RewriteRule (.*) https://%{SERVER_NAME}/$1 [R=301,L]

# Disable directory listing and multi views
Options -Indexes -MultiViews

# Add yaml mime type
AddType text/vnd.yaml   yaml
# Add bpmn mime type
AddType text/xml        bpmn
# Add graphql scheme mime type
AddType text/plain      graphqls
# Add diff mime type
AddType text/plain      diff

# workaround for 404 with trailing slashes https://github.com/camunda-cloud/camunda-cloud-documentation/issues/403
RewriteRule ^(.*\.(yaml|bpmn|xml|png|jpeg|jpg|yml|pdf|svg|graphqls|diff))/$ /$1 [R=301,L]

##################################################################################
# 2. Broad version (or unversioned) redirects
##################################################################################

RewriteRule ^optimize/3.13.0/apis-tools/optimize-api/(.*)$ /8.5/docs/apis-tools/optimize-api/$1 [R=301,L]
RewriteRule ^optimize/3.13.0/components/(.*)$ /8.5/docs/components/optimize/$1 [R=301,L]
RewriteRule ^optimize/3.13.0/self-managed/(.*)$ /8.5/docs/self-managed/$1 [R=301,L]

# Remove Helm chart multi-namespace deployment
RewriteRule ^docs/self-managed/setup/guides/multi-namespace-deployment/?$ /8.5/docs/self-managed/operational-guides/production-guide/helm-chart-production-guide/ [R=301,L]

# Remove Starter Plan
RewriteRule ^docs/components/console/manage-plan/upgrade-to-starter-plan/?$ /8.5/docs/components/console/manage-plan/upgrade-to-enterprise-plan/ [R=301,L]

RewriteRule ^docs/components/console/manage-plan/migrate-from-prof-to-starter/?$ /8.5/docs/components/console/manage-plan/available-plans/ [R=301,L]

# Rename indices page
RewriteRule ^docs/self-managed/setup/guides/prefix-elasticsearch-opensearch-indices/(.*)$ /8.5/docs/self-managed/setup/guides/prefix-elasticsearch-indices/ [R=301,L]

# Restructure Identity Docs (8.5)
RewriteRule ^docs/self-managed/setup/guides/using-existing-keycloak/?$ /8.5/docs/self-managed/components/management-identity/configuration/connect-to-an-existing-keycloak/ [R=301,L]
RewriteRule ^docs/self-managed/setup/guides/connect-to-an-oidc-provider/?$ /8.5/docs/self-managed/components/management-identity/configuration/connect-to-an-oidc-provider/ [R=301,L]
RewriteRule ^docs/self-managed/concepts/access-control/applications/?$ /8.5/docs/self-managed/components/management-identity/application-user-group-role-management/applications/ [R=301,L]
RewriteRule ^docs/self-managed/concepts/access-control/resource-authorizations/?$ /8.5/docs/self-managed/components/management-identity/access-management/resource-authorizations/ [R=301,L]
RewriteRule ^docs/self-managed/concepts/access-control/user-task-access-restrictions/?$ /8.5/docs/self-managed/components/tasklist/user-task-access-restrictions/ [R=301,L]
RewriteRule ^docs/self-managed/concepts/mapping-rules/?$ /8.5/docs/self-managed/components/management-identity/mapping-rules/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/getting-started/install-identity/?$ /8.5/docs/self-managed/components/management-identity/install-identity/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/configuration/making-identity-production-ready/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/making-identity-production-ready/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/configuration/configure-external-identity-provider/?$ /8.5/docs/self-managed/components/management-identity/configuration/configure-external-identity-provider/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/configuration/configure-logging/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/configure-logging/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/configuration/connect-to-an-existing-keycloak/?$ /8.5/docs/self-managed/components/management-identity/configuration/connect-to-an-existing-keycloak/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/roles/manage-roles/?$ /8.5/docs/self-managed/components/management-identity/application-user-group-role-management/manage-roles/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/roles/manage-permissions/?$ /8.5/docs/self-managed/components/management-identity/access-management/manage-permissions/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/groups/manage-groups/?$ /8.5/docs/self-managed/components/management-identity/application-user-group-role-management/manage-groups/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/groups/manage-users-roles-to-group/?$ /8.5/docs/self-managed/components/management-identity/application-user-group-role-management/manage-groups/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/authorizations/managing-resource-authorizations/?$ /8.5/docs/self-managed/components/management-identity/access-management/resource-authorizations/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/authorizations/managing-user-access/?$ /8.5/docs/self-managed/components/management-identity/access-management/manage-permissions/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/authorizations/generating-m2m-tokens/?$ /8.5/docs/self-managed/components/management-identity/authentication/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/tenants/managing-tenants/?$ /8.5/docs/self-managed/components/management-identity/manage-tenants/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/mapping-rules/managing-mapping-rules/?$ /8.5/docs/self-managed/components/management-identity/mapping-rules/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/additional-features/adding-an-api/?$ /8.5/docs/self-managed/components/management-identity/access-management/access-management-overview/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/additional-features/incorporate-applications/?$ /8.5/docs/self-managed/components/management-identity/application-user-group-role-management/applications/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/deployment/configuration-variables/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/configuration-variables/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/deployment/application-monitoring/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/application-monitoring/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/deployment/starting-configuration-for-identity/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/starting-configuration/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/deployment/resource-management/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/resource-management/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/troubleshooting/troubleshoot-identity/?$ /8.5/docs/self-managed/components/management-identity/miscellaneous/troubleshoot-identity/ [R=301,L]
RewriteRule ^docs/self-managed/concepts/access-control/apis/?$ /8.5/docs/self-managed/components/management-identity/access-management/access-management-overview [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/install-identity/?$ /8.5/docs/self-managed/components/management-identity/identity-first-steps/ [R=301,L]
RewriteRule ^docs/self-managed/components/management-identity/user-guide/configuration/alternative-db/?$ /8.5/docs/self-managed/components/management-identity/configuration/alternative-db/ [R=301,L]

# Restructure Backup and restore guide
RewriteRule ^docs/self-managed/operational-guides/backup-restore/modeler-backup-and-restore/?$ /8.5/docs/self-managed/operational-guides/backup-restore/backup-and-restore/ [R=301,L]

# Reroute element templates and HTTL to C7 docs
RewriteRule ^docs/components/modeler/desktop-modeler/element-templates/c7-defining-templates/(.*)$ https://docs.camunda.org/manual/latest/modeler/element-templates/ [R=301,L]

RewriteRule ^docs/components/modeler/reference/modeling-guidance/rules/history-time-to-live/(.*)$ https://docs.camunda.org/manual/latest/modeler/history-time-to-live/ [R=301,L]

# Remove outdated message correlation guide
RewriteRule ^docs/guides/message-correlation/?$ /8.5/docs/guides/ [R=301,L]

RewriteRule ^docs/components/console/manage-clusters/rename-cluster/?$ /8.5/docs/components/console/manage-clusters/manage-cluster/$1 [R=301,L]
RewriteRule ^docs/components/console/manage-clusters/resume-cluster/?$ /8.5/docs/components/console/manage-clusters/manage-cluster/$1 [R=301,L]
RewriteRule ^docs/components/console/manage-clusters/update-cluster/?$ /8.5/docs/components/console/manage-clusters/manage-cluster/$1 [R=301,L]
RewriteRule ^docs/components/console/manage-clusters/delete-cluster/?$ /8.5/docs/components/console/manage-clusters/manage-cluster/$1 [R=301,L]

#remove SM Architecture page
RewriteRule ^docs/self-managed/platform-architecture/overview/?$ /8.5/docs/self-managed/about-self-managed/$1 [R=301,L]

# Move Help Center
RewriteRule ^docs/guides/camunda-help-center/(.*)$ /8.5/docs/reference/camunda-help-center/$1 [R=301,L]

# Remove updating-tasklist pages
RewriteRule ^docs/components/tasklist/userguide/updating-tasklist-cloud/?$ /8.5/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]

RewriteRule ^docs/self-managed/components/tasklist/updating-tasklist/?$ /8.5/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]

# Remove community Node Zeebe page
RewriteRule ^docs/apis-tools/community-clients/javascript/?$ /8.5/docs/apis-tools/node-js-sdk/$1 [R=301,L]

# Remove "new web modeler" page, re-route to launch-web-modeler rather than launch-cloud-modeler
RewriteRule ^docs/components/modeler/web-modeler/new-web-modeler/?$ /8.5/docs/components/modeler/web-modeler/launch-web-modeler/$1 [R=301,L]
RewriteRule ^docs/components/modeler/web-modeler/launch-cloud-modeler/?$ /8.5/docs/components/modeler/web-modeler/launch-web-modeler/$1 [R=301,L]

##################################################################################
#
#  Hey friend! There's a good chance you've left the redirect party, come back!
#
#  If you're dropping new redirect rules at the bottom of this file,
#    it must mean you're only applying them to the oldest supported version of the docs.
#  If that's not the case, please add them higher in the file,
#    after the comment block associated with the version of your changes.
#  This helps us keep track of when redirects are old enough to be removed.
#
##################################################################################
