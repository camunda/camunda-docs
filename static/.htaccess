# Welcome to the redirect party!
#  ____  ____  ____  __  ____  ____  ___  ____    ____   __   ____  ____  _  _  _
# (  _ \(  __)(    \(  )(  _ \(  __)/ __)(_  _)  (  _ \ / _\ (  _ \(_  _)( \/ )/ \
#  )   / ) _)  ) D ( )(  )   / ) _)( (__   )(     ) __//    \ )   /  )(   )  / \_/
# (__\_)(____)(____/(__)(__\_)(____)\___) (__)   (__)  \_/\_/(__\_) (__) (__/  (_)
#
# Please read this guide before adding new redirects.
#
##################################################################################
#
# Redirects in this file are sorted in this order:
#  1. Universal rules that pertain to all content.
#     These redirects have no anticipated removal.
#  2. Broad version (or unversioned) redirects.
#     These redirects have no anticipated removal.
#  3. Specific content moves, in newest-to-oldest order of version in which they are introduced.
#     These redirects will be removed when their introduced version is no longer supported.
#
#  If you're adding a redirect for a specific page or section,
#   you likely want to do that in #3.
#  That means that you want to find the banner comment identifying that version,
#    and add your redirect below that comment.
#
# For help writing rules, see https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewriterule.
#
##################################################################################

##################################################################################
# 1. Universal rules
##################################################################################

# Redirect to https
RewriteEngine on
RewriteCond %{SERVER_PORT} !^443$
RewriteRule (.*) https://%{SERVER_NAME}/$1 [R=301,L]

# Disable directory listing and multi views
Options -Indexes -MultiViews

# Add yaml mime type
AddType text/vnd.yaml   yaml
# Add bpmn mime type
AddType text/xml        bpmn
# Add graphql scheme mime type
AddType text/plain      graphqls
# Add diff mime type
AddType text/plain      diff

# workaround for 404 with trailing slashes https://github.com/camunda-cloud/camunda-cloud-documentation/issues/403
RewriteRule ^(.*\.(yaml|bpmn|xml|png|jpeg|jpg|yml|pdf|svg|graphqls|diff))/$ /$1 [R=301,L]

##################################################################################
# 2. Broad version (or unversioned) redirects
##################################################################################

## Reabsorbed Optimize docs
RewriteRule ^optimize/apis-tools/optimize-api/(.*)$ /8.3/docs/apis-tools/optimize-api/$1 [R=301,L]
RewriteRule ^optimize/components/(.*)$ /8.3/docs/components/optimize/$1 [R=301,L]
RewriteRule ^optimize/self-managed/(.*)$ /8.3/docs/self-managed/$1 [R=301,L]

##################################################################################
# 3. Specific content moves
##################################################################################

#remove SM Architecture page
RewriteRule ^docs/self-managed/platform-architecture/overview/?$ /8.3/docs/self-managed/about-self-managed/$1 [R=301,L]

RewriteRule ^docs/self-managed/operational-guides/update-guide/800-to-810/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]
RewriteRule ^docs/self-managed/operational-guides/update-guide/130-to-800/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]
RewriteRule ^docs/self-managed/operational-guides/update-guide/810-to-820/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]

# Remove Cawemo
RewriteRule ^docs/guides/migrating-from-cawemo/?$ https://docs.camunda.org/enterprise/announcement/#cawemo-saas-announcements [R=301,L]


# Remove updating-tasklist pages
RewriteRule ^docs/components/tasklist/userguide/updating-tasklist-cloud/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]
RewriteRule ^docs/self-managed/tasklist-deployment/updating-tasklist/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]

# Remove "new web modeler" page, re-route to launch-web-modeler rather than launch-cloud-modeler
RewriteRule ^docs/components/modeler/web-modeler/new-web-modeler/?$ /8.3/docs/components/modeler/web-modeler/launch-web-modeler/$1 [R=301,L]
RewriteRule ^docs/components/modeler/web-modeler/launch-cloud-modeler/?$ /8.3/docs/components/modeler/web-modeler/launch-web-modeler/$1 [R=301,L]

# Remove updating-operate pages
RewriteRule ^docs/components/operate/userguide/updating-operate/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]
RewriteRule ^docs/self-managed/operate-deployment/updating-operate/?$ /8.3/docs/self-managed/operational-guides/update-guide/introduction/$1 [R=301,L]

# Rename whitelist to allowlist
RewriteRule ^docs/components/console/manage-clusters/manage-ip-whitelists/?$ /8.3/docs/components/console/manage-clusters/manage-ip-allowlists/$1 [R=301,L]

# Move install-zeebe-exporters
RewriteRule ^docs/self-managed/platform-deployment/helm-kubernetes/guides/install-zeebe-exporters/?$ /8.3/docs/self-managed/zeebe-deployment/exporters/install-zeebe-exporters/$1 [R=301,L]

# Rename Console API
RewriteRule ^docs/apis-tools/console-api-reference/?$ /8.3/docs/apis-tools/administration-api-reference/$1 [R=301,L]

# Remove Operate feedback page
RewriteRule ^docs/components/operate/userguide/operate-feedback-and-questions/?$ /contact/$1 [R=301,L]

# Redirect to Connectors overview upon deprecation of Power Automate Connector
RewriteRule ^docs/components/connectors/out-of-the-box-connectors/power-automate/?$ /8.3/docs/components/connectors/out-of-the-box-connectors/available-connectors-overview/ [R=301,L]

# Early access to alpha features
RewriteRule ^docs/reference/early-access/?$ /8.3/docs/reference/alpha-features/ [R=301,L]

##################################################################################
#
#  Hey friend! There's a good chance you've left the redirect party, come back!
#
#  If you're dropping new redirect rules at the bottom of this file, 
#    it must mean you're only applying them to the oldest supported version of the docs.
#  If that's not the case, please add them higher in the file, 
#    after the comment block associated with the version of your changes.
#  This helps us keep track of when redirects are old enough to be removed.
#
##################################################################################
