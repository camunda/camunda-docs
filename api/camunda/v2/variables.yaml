paths:
  /variables/search:
    post:
      tags:
        - Variable
      operationId: searchVariables
      summary: Search variables
      description: |-


        [[CONSISTENCY:EVENTUAL]]

        Search for variables based on given criteria.

        This endpoint returns variables that exist directly at the specified scopes - it does not
        include variables from parent scopes that would be visible through the scope hierarchy.

        Variables can be process-level (scoped to the process instance) or local (scoped to specific
        BPMN elements like tasks, subprocesses, etc.).

        By default, long variable values in the response are truncated.
      parameters:
        - name: truncateValues
          in: query
          required: false
          description: When true (default), long variable values in the response are truncated. When false, full variable values are returned.
          schema:
            type: boolean
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VariableSearchQuery"
      responses:
        "200":
          description: The variable search result.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VariableSearchQueryResult"
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "common-responses.yaml#/components/responses/Forbidden"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
  /variables/{variableKey}:
    get:
      tags:
        - Variable
      operationId: getVariable
      summary: Get variable
      description: |-


        [[CONSISTENCY:EVENTUAL]]

        Get a variable by its key.

        This endpoint returns both process-level and local (element-scoped) variables.
        The variable's scopeKey indicates whether it's a process-level variable or scoped to a
        specific element instance.
      parameters:
        - name: variableKey
          in: path
          required: true
          description: The variable key.
          schema:
            type: string
            format: string<VariableKey>
            example: "2251799813683287"
            description: System-generated key for a variable.
      responses:
        "200":
          description: The variable is successfully returned.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VariableResult"
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "common-responses.yaml#/components/responses/Forbidden"
        "404":
          description: Not found
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
components:
  schemas:
    VariableSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - value
            - name
            - tenantId
            - variableKey
            - scopeKey
            - processInstanceKey
        order:
          $ref: "search-models.yaml#/components/schemas/SortOrderEnum"
      required:
        - field
    VariableSearchQuery:
      description: Variable search query request.
      type: object
      allOf:
        - $ref: "search-models.yaml#/components/schemas/SearchQueryRequest"
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: "#/components/schemas/VariableSearchQuerySortRequest"
        filter:
          description: The variable search filters.
          allOf:
            - $ref: "#/components/schemas/VariableFilter"
    VariableFilter:
      description: Variable filter request.
      type: object
      properties:
        name:
          description: Name of the variable.
          allOf:
            - $ref: "filters.yaml#/components/schemas/StringFilterProperty"
        value:
          description: The value of the variable.
          allOf:
            - $ref: "filters.yaml#/components/schemas/StringFilterProperty"
        tenantId:
          description: Tenant ID of this variable.
          allOf:
            - $ref: "identifiers.yaml#/components/schemas/TenantId"
        isTruncated:
          description: Whether the value is truncated or not.
          type: boolean
        variableKey:
          description: The key for this variable.
          allOf:
            - $ref: "keys.yaml#/components/schemas/VariableKeyFilterProperty"
        scopeKey:
          description: |
            The key of the scope that defines where this variable is directly defined. This can be a
            process instance key (for process-level variables) or an element instance key (for local
            variables scoped to tasks, subprocesses, gateways, events, etc.). Use this filter to
            find variables directly defined in specific scopes. Note that this does not include
            variables from parent scopes that would be visible through the scope hierarchy.
          allOf:
            - $ref: "keys.yaml#/components/schemas/ScopeKeyFilterProperty"
        processInstanceKey:
          description: The key of the process instance of this variable.
          allOf:
            - $ref: "keys.yaml#/components/schemas/ProcessInstanceKeyFilterProperty"
    VariableSearchQueryResult:
      description: Variable search query response.
      type: object
      allOf:
        - $ref: "search-models.yaml#/components/schemas/SearchQueryResponse"
      properties:
        items:
          description: The matching variables.
          type: array
          items:
            $ref: "#/components/schemas/VariableSearchResult"
    VariableSearchResult:
      description: Variable search response item.
      type: object
      allOf:
        - $ref: "#/components/schemas/VariableResultBase"
      properties:
        value:
          description: Value of this variable. Can be truncated.
          type: string
        isTruncated:
          description: Whether the value is truncated or not.
          type: boolean
    VariableResult:
      description: Variable search response item.
      type: object
      allOf:
        - $ref: "#/components/schemas/VariableResultBase"
      properties:
        value:
          description: Full value of this variable.
          type: string
    VariableResultBase:
      description: Variable response item.
      type: object
      properties:
        name:
          description: Name of this variable.
          type: string
        tenantId:
          allOf:
            - $ref: "identifiers.yaml#/components/schemas/TenantId"
          description: Tenant ID of this variable.
        variableKey:
          allOf:
            - $ref: "keys.yaml#/components/schemas/VariableKey"
          description: The key for this variable.
        scopeKey:
          allOf:
            - $ref: "keys.yaml#/components/schemas/ScopeKey"
          description: |
            The key of the scope where this variable is directly defined. For process-level
            variables, this is the process instance key. For local variables, this is the key of the
            specific element instance (task, subprocess, gateway, event, etc.) where the variable is
            directly defined.
        processInstanceKey:
          allOf:
            - $ref: "keys.yaml#/components/schemas/ProcessInstanceKey"
          description: The key of the process instance of this variable.
        rootProcessInstanceKey:
          description: |
            The key of the root process instance. The root process instance is the top-level
            ancestor in the process instance hierarchy. This field is only present for data
            belonging to process instance hierarchies created in version 8.9 or later.
          nullable: true
          allOf:
            - $ref: "keys.yaml#/components/schemas/ProcessInstanceKey"
    VariableValueFilterProperty:
      type: object
      properties:
        name:
          type: string
          description: Name of the variable.
        value:
          allOf:
            - $ref: "filters.yaml#/components/schemas/StringFilterProperty"
          description: The value of the variable.
      required:
        - name
        - value
    SetVariableRequest:
      type: object
      properties:
        variables:
          description: JSON object representing the variables to set in the elementâ€™s scope.
          additionalProperties: true
          type: object
        local:
          description: |-
            If set to `true`, the variables are merged strictly into the local scope (as specified
            by the `elementInstanceKey`). Otherwise, the variables are propagated to upper scopes
            and set at the outermost one.

            Let's consider the following example:
            There are two scopes '1' and '2'. Scope '1' is the parent scope of '2'. The effective
            variables of the scopes are:
            1 => { "foo" : 2 }
            2 => { "bar" : 1 }

            An update request with elementInstanceKey as '2', variables { "foo": 5 }, and local set
            to `true` leaves scope '1' unchanged and adjusts scope '2' to { "bar": 1, "foo": 5 }. By
            default, with local set to `false`, scope '1' will be { "foo": 5 } and scope '2' will be
            { "bar": 1 }.
          type: boolean
          default: false
        operationReference:
          $ref: "keys.yaml#/components/schemas/OperationReference"
      required:
        - variables
