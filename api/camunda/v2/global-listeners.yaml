paths:
  /global-listeners/user-task:
    post:
      tags:
        - Global listener
      operationId: createGlobalTaskListener
      summary: Create global user task listener
      description: |-


        [[CONSISTENCY:STRONG]]

        Create a new global user task listener.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGlobalTaskListenerRequest"
        required: true
      responses:
        "201":
          description: The global user task listener was created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GlobalTaskListenerResult"
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "common-responses.yaml#/components/responses/Forbidden"
        "409":
          description: A global listener with this id already exists.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
        "503":
          $ref: "common-responses.yaml#/components/responses/ServiceUnavailable"
  /global-listeners/user-task/{id}:
    put:
      tags:
        - Global listener
      operationId: updateGlobalTaskListener
      summary: Update global user task listener
      description: |-


        [[CONSISTENCY:STRONG]]

        Updates a global user task listener.
      parameters:
        - name: id
          in: path
          required: true
          description: The id of the global user task listener to update.
          schema:
            $ref: "identifiers.yaml#/components/schemas/GlobalListenerId"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateGlobalTaskListenerRequest"
        required: true
      responses:
        "200":
          description: The global listener was updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GlobalTaskListenerResult"
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "common-responses.yaml#/components/responses/Forbidden"
        "404":
          description: The global user task listener was not found.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
        "503":
          $ref: "common-responses.yaml#/components/responses/ServiceUnavailable"
    delete:
      tags:
        - Global listener
      operationId: deleteGlobalTaskListener
      summary: Delete global user task listener
      description: |-


        [[CONSISTENCY:STRONG]]

        Deletes a global user task listener.
      parameters:
        - name: id
          in: path
          required: true
          description: The id of the global user task listener to delete.
          schema:
            $ref: "identifiers.yaml#/components/schemas/GlobalListenerId"
      responses:
        "204":
          description: The global listener was deleted successfully.
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "common-responses.yaml#/components/responses/Forbidden"
        "404":
          description: The global user task listener was not found.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
        "503":
          $ref: "common-responses.yaml#/components/responses/ServiceUnavailable"
components:
  schemas:
    GlobalListenerSourceEnum:
      type: string
      enum:
        - CONFIGURATION
        - API
      description: How the global listener was defined.
    GlobalTaskListenerEventTypeEnum:
      type: string
      enum:
        - all
        - creating
        - assigning
        - updating
        - completing
        - canceling
      description: The event type that triggers the user task listener.
    GlobalListenerBase:
      type: object
      properties:
        type:
          description: The name of the job type, used as a reference to specify which job workers request the respective listener job.
          type: string
          example: order-items
        retries:
          description: Number of retries for the listener job.
          type: integer
        afterNonGlobal:
          description: Whether the listener should run after model-level listeners.
          type: boolean
        priority:
          description: The priority of the listener. Higher priority listeners are executed before lower priority ones.
          type: integer
    GlobalTaskListenerBase:
      type: object
      allOf:
        - $ref: "#/components/schemas/GlobalListenerBase"
      properties:
        eventTypes:
          $ref: "#/components/schemas/GlobalTaskListenerEventTypes"
    GlobalTaskListenerEventTypes:
      description: List of user task event types that trigger the listener.
      type: array
      items:
        $ref: "#/components/schemas/GlobalTaskListenerEventTypeEnum"
    CreateGlobalTaskListenerRequest:
      type: object
      required:
        - id
        - type
        - eventTypes
      allOf:
        - $ref: "#/components/schemas/GlobalTaskListenerBase"
      properties:
        id:
          $ref: "identifiers.yaml#/components/schemas/GlobalListenerId"
    UpdateGlobalTaskListenerRequest:
      type: object
      required:
        - type
        - eventTypes
      allOf:
        - $ref: "#/components/schemas/GlobalTaskListenerBase"
    GlobalTaskListenerResult:
      type: object
      allOf:
        - $ref: "#/components/schemas/GlobalTaskListenerBase"
      properties:
        id:
          $ref: "identifiers.yaml#/components/schemas/GlobalListenerId"
        source:
          $ref: "#/components/schemas/GlobalListenerSourceEnum"
